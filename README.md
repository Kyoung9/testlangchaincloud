# 天気情報取得 LangGraph プロジェクト

[![CI](https://github.com/langchain-ai/new-langgraph-project/actions/workflows/unit-tests.yml/badge.svg)](https://github.com/langchain-ai/new-langgraph-project/actions/workflows/integration-tests.yml)
[![Integration Tests](https://github.com/langchain-ai/new-langgraph-project/actions/workflows/integration-tests.yml/badge.svg)](https://github.com/langchain-ai/new-langgraph-project/actions/workflows/integration-tests.yml)

このプロジェクトは、[LangGraph](https://github.com/langchain-ai/langgraph)を使用して実装された天気情報取得アプリケーションです。[LangGraph Server](https://langchain-ai.github.io/langgraph/concepts/langgraph_server/#langgraph-server)の使用方法と[LangGraph Studio](https://langchain-ai.github.io/langgraph/concepts/langgraph_studio/)での視覚的デバッグを学ぶために設計されています。

<div align="center">
  <img src="./static/studio_ui.png" alt="Graph view in LangGraph studio UI" width="75%" />
</div>

`src/agent/graph.py`で定義されたコアロジックは、自然言語の入力から都市名を抽出し、OpenWeatherMap APIから現在の天気情報を取得する2段階のアプリケーションです。

このグラフを拡張して、より複雑なエージェントワークフローを構築し、LangGraph Studioで視覚化・デバッグすることができます。

## 機能

- 🌍 自然言語 입력으로 도시명 자동 추출
- 🌡️ 気温、体感温度、湿度、気圧などの詳細情報
- 🌪️ 風速、視界などの気象データ
- 🌐 日本語での天気説明
- ⚡ 非同期処理による高速なAPI呼び出し
- 🔧 設定可能なAPIキー
- 🤖 LLM을 사용한 지능형 도시명 인식

## セットアップ

### 1. 依存関係のインストール

[LangGraph CLI](https://langchain-ai.github.io/langgraph/concepts/langgraph_cli/)と共に依存関係をインストールします。

```bash
cd path/to/your/app
pip install -e . "langgraph-cli[inmem]"
```

### 2. APIキーの設定

1. **OpenWeatherMap APIキー**: [OpenWeatherMap](https://openweathermap.org/api)で無料アカウントを作成し、APIキーを取得
2. **OpenAI APIキー**: [OpenAI](https://platform.openai.com/api-keys)でAPIキーを取得
3. 環境変数ファイルを作成

```bash
cp .env.example .env
```

4. `.env`ファイルに実際のAPIキーを設定

```text
# .env
OPENWEATHER_API_KEY=your_actual_openweather_api_key_here
OPENAI_API_KEY=your_actual_openai_api_key_here
```

### 3. LangGraph Serverの起動

```shell
langgraph dev
```

LangGraph Serverの詳細については[こちら](https://langchain-ai.github.io/langgraph/tutorials/langgraph-platform/local-server/)を参照してください。

## 使用方法

### コマンドラインでの使用

```bash
python example_usage.py
```

자연어로 질문하면 자동으로 도시명을 추출하고 날씨 정보를 표시합니다.

**입력 예시:**
- "도쿄의 날씨는 어떤가요?"
- "how's the weather in Tokyo?"
- "서울 날씨 알려줘"
- "What's the weather like in Paris?"

### プログラムでの使用

```python
import asyncio
from src.agent.graph import graph, State

async def get_weather(user_input: str):
    initial_state = State(user_input=user_input)
    config = {
        "configurable": {
            "openai_api_key": "your_openai_api_key",
            "api_key": "your_openweather_api_key"
        }
    }
    
    result = await graph.ainvoke(initial_state, config)
    return result

# 使用例
weather = await get_weather("도쿄의 날씨는 어떤가요?")
print(weather)
```

## アーキテクチャ

### 1. 도시명 추출 단계 (extract_city)
- LLM을 사용하여 자연어 입력에서 도시명 추출
- 한국어, 영어 등 다양한 언어 지원
- 명확한 도시명이 없는 경우 에러 처리

### 2. 날씨 정보 조회 단계 (get_weather)
- 추출된 도시명으로 OpenWeatherMap API 호출
- 상세한 날씨 정보 반환
- API 에러 및 예외 상황 처리

## カスタマイ즈方法

### 1. 設定可能なパラメータの定義

`graph.py`ファイルの`Configuration`クラスを修正して、設定したい引数を公開します。例えば、異なる温度単位や言語設定を動的に変更できます。

### 2. グラフの拡張

アプリケーションのコアロジックは[graph.py](./src/agent/graph.py)で定義されています。このファイルを修正して、新しいノード、エッジを追加したり、情報の流れを変更したりできます。

## 開発

LangGraph Studioでグラフを反復開発する際は、過去の状態を編集して特定のノードからアプリを再実行してデバッグできます。ローカルの変更はホットリロードにより自動的に適用されます。

フォローアップリクエストは同じスレッドを拡張します。右上の`+`ボタンを使用して、以前の履歴をクリアして完全に新しいスレッドを作成できます。

より高度な機能と例については、[LangGraphドキュメント](https://langchain-ai.github.io/langgraph/)を参照してください。これらのリソースは、このテンプレートを特定のユースケースに適応させ、より洗練された会話エージェントを構築するのに役立ちます。

LangGraph Studioは[LangSmith](https://smith.langchain.com/)と統合されており、より詳細なトレーシングとチームメンバーとのコラボレーションが可能で、チャットボットのパフォーマンスを分析・最適化できます。

## 注意事項

- OpenWeatherMap APIは無料プランで1分間に60回のリクエスト制限があります
- OpenAI API는 사용량에 따라 요금이 부과됩니다
- APIキーは機密情報なので、`.env`ファイルに保存し、Gitにコミットしないでください
- 한국어, 영어 등 다양한 언어로 입력 가능합니다

<!--
Configuration auto-generated by `langgraph template lock`. DO NOT EDIT MANUALLY.
{
  "config_schemas": {
    "agent": {
      "type": "object",
      "properties": {
        "api_key": {
          "type": "string",
          "description": "OpenWeatherMap APIキー"
        },
        "openai_api_key": {
          "type": "string",
          "description": "OpenAI APIキー"
        }
      }
    }
  }
}
-->
